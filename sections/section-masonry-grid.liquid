{% schema %}
{
  "name": "Masonry Grid",
  "tag": "section",
  "class": "section-masonry-grid",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop by Category"
    },
    {
       "type": "text",
       "id": "subheading",
       "label": "Subheading",
       "default": "Explore our curated collections"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Collection"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle",
          "default": "View Products"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
           "type": "select",
           "id": "size",
           "label": "Block Size",
           "options": [
              { "value": "small", "label": "Small (1x1)" },
              { "value": "tall", "label": "Tall (1x2)" },
              { "value": "wide", "label": "Wide (2x1)" },
              { "value": "large", "label": "Large (2x2)" }
           ],
           "default": "small"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Masonry Grid",
      "blocks": [
        { "type": "category", "settings": { "size": "tall" } },
        { "type": "category", "settings": { "size": "small" } },
        { "type": "category", "settings": { "size": "small" } },
        { "type": "category", "settings": { "size": "tall" } }
      ]
    }
  ]
}
{% endschema %}

<div class="section-padding">
  <div class="container">
    {% if section.settings.heading != blank %}
      <div class="text-center mb-8">
        <h2 class="text-3xl font-heading font-bold">{{ section.settings.heading }}</h2>
        <p class="text-muted mt-2">{{ section.settings.subheading }}</p>
      </div>
    {% endif %}

    <div class="masonry-grid">
      {% for block in section.blocks %}
        <a href="{{ block.settings.link }}" class="masonry-item {{ block.settings.size }} group" {{ block.shopify_attributes }}>
          <div class="masonry-content relative overflow-hidden rounded-lg h-full">
            {% if block.settings.image != blank %}
              {{ block.settings.image | image_url: width: 800 | image_tag: loading: 'lazy', class: 'w-full h-full object-cover transition-transform duration-700 group-hover:scale-110' }}
            {% else %}
              {{ 'collection-' | append: forloop.index | placeholder_svg_tag: 'w-full h-full object-cover bg-gray-100' }}
            {% endif %}
            
            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors"></div>
            
            <div class="absolute bottom-0 left-0 p-6 text-white translate-y-2 group-hover:translate-y-0 transition-transform">
              <h3 class="text-xl font-bold">{{ block.settings.title }}</h3>
              <p class="text-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300 mt-1">{{ block.settings.subtitle }}</p>
            </div>
          </div>
        </a>
      {% endfor %}
    </div>
  </div>
</div>

<style>
.masonry-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-auto-rows: 250px;
  gap: 16px;
}
@media(min-width: 768px) {
  .masonry-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}
.masonry-item.small { grid-column: span 1; grid-row: span 1; }
.masonry-item.tall { grid-column: span 1; grid-row: span 2; }
.masonry-item.wide { grid-column: span 2; grid-row: span 1; }
.masonry-item.large { grid-column: span 2; grid-row: span 2; }

@media(max-width: 767px) {
   /* On mobile, collapse simplified grid or keep masonry? Keeping simple for robustness */
   .masonry-item.wide, .masonry-item.large { grid-column: span 2; }
}
</style>
