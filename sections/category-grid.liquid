{% comment %}
  AONA Premium "Smart" Bento Category Grid
  Mobile: Clean 2-Column Square Grid
  Desktop: Smart Grid that automatically fixes itself for 3, 4, or 5 blocks!
{% endcomment %}

<section class="category-grid-section">
  <div class="category-grid-header">
    <h2 class="grid-title">{{ section.settings.title | default: "Shop by Category" }}</h2>
    <p class="grid-subtitle">{{ section.settings.subtitle | default: "Explore our curated collections" }}</p>
  </div>

  <div class="category-bento-grid">
    {% for block in section.blocks limit: 5 %}
      <a href="{{ block.settings.link | default: '#' }}" class="category-card item-{{ forloop.index }}" {{ block.shopify_attributes }}>
        
        <div class="card-image-wrapper">
          {% if block.settings.image != blank %}
            <img src="{{ block.settings.image | image_url: width: 800 }}" alt="{{ block.settings.title }}" class="card-image" loading="lazy">
          {% else %}
            <div class="placeholder-img">
              {{ 'collection-' | append: forloop.index | placeholder_svg_tag: 'card-image' }}
            </div>
          {% endif %}
        </div>
        
        <div class="card-overlay"></div>
        
        <div class="card-content">
          <h3 class="card-title">{{ block.settings.title }}</h3>
          {% if block.settings.product_count != blank %}
            <p class="card-count">{{ block.settings.product_count }} Products</p>
          {% endif %}
        </div>
        
      </a>
    {% endfor %}
  </div>
</section>

<style>
/* ==========================================
   1. GLOBAL & MOBILE (Base Styles)
   ========================================== */
.category-grid-section {
  padding: 30px 16px;
  background: white;
  max-width: 1400px;
  margin: 0 auto;
}

.category-grid-header {
  text-align: center;
  margin-bottom: 24px;
}

.grid-title {
  font-family: 'Playfair Display', serif;
  font-size: 24px;
  color: #1A1A1A;
  margin-bottom: 6px;
}

.grid-subtitle {
  font-size: 14px;
  color: #666;
  margin: 0;
}

/* MOBILE GRID: 2-Column Perfect Squares */
.category-bento-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr); 
  gap: 12px;
}

.category-card {
  text-decoration: none;
  display: block;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
  aspect-ratio: 1 / 1; /* Forces perfect squares on mobile */
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  width: 100%;
  height: 100%;
}

.card-image-wrapper {
  position: absolute;
  inset: 0;
  background: #f5f5f6;
  width: 100%;
  height: 100%;
}

.card-image, .placeholder-img svg {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform 0.6s ease;
}

.placeholder-img {
  width: 100%;
  height: 100%;
  background: #e0e0e0;
}

/* Dark Gradient Overlay for text readability */
.card-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.2) 45%, rgba(0,0,0,0) 100%);
  z-index: 1;
}

/* Text inside card - Mobile Adjusted */
.card-content {
  position: absolute;
  bottom: 12px;
  left: 12px;
  right: 12px;
  color: white;
  z-index: 2;
}

.card-title {
  font-family: 'Playfair Display', serif;
  font-size: 15px; /* Scaled down for mobile squares */
  margin: 0 0 2px;
  font-weight: 600;
  letter-spacing: 0.5px;
  line-height: 1.2;
}

.card-count {
  font-size: 9px; /* Scaled down for mobile */
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 700;
  margin: 0;
}

/* ==========================================
   2. DESKTOP SMART BENTO GRID (PC ONLY)
   ========================================== */
@media (min-width: 992px) {
  .category-grid-section {
    padding: 60px 40px;
  }
  
  .grid-title {
    font-size: 36px;
    margin-bottom: 10px;
  }

  .card-content {
    bottom: 24px;
    left: 24px;
    right: 24px;
  }

  .card-title {
    font-size: 22px; /* Bigger font on PC */
    margin-bottom: 4px;
  }

  .card-count {
    font-size: 12px;
  }

  .category-card {
    aspect-ratio: auto; /* Allow CSS Grid to control height */
  }

  .category-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.15);
  }
  
  .category-card:hover .card-image {
    transform: scale(1.05);
  }

  /* Grid Engine */
  .category-bento-grid {
    grid-template-columns: repeat(4, 1fr); /* 4 Columns */
    grid-template-rows: repeat(2, 280px); /* Strict height so they never get cut off */
    gap: 20px;
  }

  /* ITEM 1: Always a Giant Square on the Left */
  .category-card:nth-child(1) {
    grid-column: 1 / 3;
    grid-row: 1 / 3;
  }
  .category-card:nth-child(1) .card-title { font-size: 36px; margin-bottom: 8px;}
  .category-card:nth-child(1) .card-count { font-size: 14px; }

  /* DEFAULT 5-BLOCK LAYOUT */
  .category-card:nth-child(2) { grid-column: 3 / 4; grid-row: 1 / 2; }
  .category-card:nth-child(3) { grid-column: 4 / 5; grid-row: 1 / 2; }
  .category-card:nth-child(4) { grid-column: 3 / 4; grid-row: 2 / 3; }
  .category-card:nth-child(5) { grid-column: 4 / 5; grid-row: 2 / 3; }

  /* SMART FIX 1: If there are exactly 4 blocks, stretch the 4th block to fill the gap! */
  .category-card:nth-child(4):last-child {
    grid-column: 3 / 5;
    grid-row: 2 / 3;
  }

  /* SMART FIX 2: If there are exactly 3 blocks, stretch the 2nd and 3rd blocks! */
  .category-card:nth-child(2):nth-last-child(2) {
    grid-column: 3 / 5;
    grid-row: 1 / 2;
  }
  .category-card:nth-child(3):last-child {
    grid-column: 3 / 5;
    grid-row: 2 / 3;
  }
}
</style>

{% schema %}
{
  "name": "Category Grid",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Shop by Category"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Explore our curated collections"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category Block",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Category Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Category Title",
          "default": "Category Name"
        },
        {
          "type": "text",
          "id": "product_count",
          "label": "Product Count",
          "default": "120+"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Category Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Category Grid",
      "blocks": [
        { "type": "category", "settings": { "title": "Brass Idols", "product_count": "150+" } },
        { "type": "category", "settings": { "title": "Resin Art", "product_count": "85+" } },
        { "type": "category", "settings": { "title": "Wall Decor", "product_count": "45+" } },
        { "type": "category", "settings": { "title": "Copper Items", "product_count": "60+" } }
      ]
    }
  ]
}
{% endschema %}